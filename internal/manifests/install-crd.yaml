---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
  name: agentconfigs.axon.io
spec:
  group: axon.io
  names:
    kind: AgentConfig
    listKind: AgentConfigList
    plural: agentconfigs
    singular: agentconfig
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: AgentConfig is the Schema for the agentconfigs API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AgentConfigSpec defines the desired state of AgentConfig.
            properties:
              agentsMD:
                description: |-
                  AgentsMD is written to the agent's instruction file
                  (e.g., ~/.claude/CLAUDE.md for Claude Code).
                  This is additive and does not overwrite the repo's own instruction files.
                type: string
              plugins:
                description: |-
                  Plugins defines Claude Code plugins to inject via --plugin-dir.
                  Each plugin is mounted as a separate plugin directory.
                  Only applicable to claude-code type agents; other agents ignore this.
                items:
                  description: PluginSpec defines a Claude Code plugin bundle.
                  properties:
                    agents:
                      description: |-
                        Agents defines sub-agents for this plugin.
                        Each becomes agents/<name>.md in the plugin directory.
                      items:
                        description: AgentDefinition defines a Claude Code sub-agent.
                        properties:
                          content:
                            type: string
                          name:
                            minLength: 1
                            type: string
                        required:
                        - content
                        - name
                        type: object
                      type: array
                    name:
                      description: |-
                        Name is the plugin name. Used as the plugin directory name
                        and for namespacing in Claude Code (e.g., <name>:skill-name).
                      minLength: 1
                      type: string
                    skills:
                      description: |-
                        Skills defines skills for this plugin.
                        Each becomes skills/<name>/SKILL.md in the plugin directory.
                      items:
                        description: SkillDefinition defines a Claude Code skill (slash
                          command).
                        properties:
                          content:
                            type: string
                          name:
                            minLength: 1
                            type: string
                        required:
                        - content
                        - name
                        type: object
                      type: array
                  required:
                  - name
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
  name: tasks.axon.io
spec:
  group: axon.io
  names:
    kind: Task
    listKind: TaskList
    plural: tasks
    singular: task
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Task is the Schema for the tasks API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: TaskSpec defines the desired state of Task.
            properties:
              agentConfigRef:
                description: AgentConfigRef references an AgentConfig resource.
                properties:
                  name:
                    description: Name is the name of the AgentConfig resource.
                    type: string
                required:
                - name
                type: object
              credentials:
                description: Credentials specifies how to authenticate with the agent.
                properties:
                  secretRef:
                    description: SecretRef references the Secret containing credentials.
                    properties:
                      name:
                        description: Name is the name of the secret.
                        type: string
                    required:
                    - name
                    type: object
                  type:
                    description: Type specifies the credential type (api-key or oauth).
                    enum:
                    - api-key
                    - oauth
                    type: string
                required:
                - secretRef
                - type
                type: object
              image:
                description: |-
                  Image optionally overrides the default agent container image.
                  Custom images must implement the agent image interface
                  (see docs/agent-image-interface.md).
                type: string
              model:
                description: Model optionally overrides the default model.
                type: string
              podOverrides:
                description: PodOverrides allows customizing the agent pod configuration.
                properties:
                  activeDeadlineSeconds:
                    description: |-
                      ActiveDeadlineSeconds specifies the maximum duration in seconds
                      that the agent pod can run before being terminated.
                      This is set on the Job's activeDeadlineSeconds field.
                    format: int64
                    minimum: 1
                    type: integer
                  env:
                    description: |-
                      Env specifies additional environment variables for the agent container.
                      These are appended after the built-in env vars (credentials, model, GitHub token).
                      If a user-specified env var conflicts with a built-in one, the built-in takes precedence.
                    items:
                      description: EnvVar represents an environment variable present
                        in a Container.
                      properties:
                        name:
                          description: |-
                            Name of the environment variable.
                            May consist of any printable ASCII characters except '='.
                          type: string
                        value:
                          description: |-
                            Variable references $(VAR_NAME) are expanded
                            using the previously defined environment variables in the container and
                            any service environment variables. If a variable cannot be resolved,
                            the reference in the input string will be unchanged. Double $$ are reduced
                            to a single $, which allows for escaping the $(VAR_NAME) syntax: i.e.
                            "$$(VAR_NAME)" will produce the string literal "$(VAR_NAME)".
                            Escaped references will never be expanded, regardless of whether the variable
                            exists or not.
                            Defaults to "".
                          type: string
                        valueFrom:
                          description: Source for the environment variable's value.
                            Cannot be used if value is not empty.
                          properties:
                            configMapKeyRef:
                              description: Selects a key of a ConfigMap.
                              properties:
                                key:
                                  description: The key to select.
                                  type: string
                                name:
                                  default: ""
                                  description: |-
                                    Name of the referent.
                                    This field is effectively required, but due to backwards compatibility is
                                    allowed to be empty. Instances of this type with an empty value here are
                                    almost certainly wrong.
                                    More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                  type: string
                                optional:
                                  description: Specify whether the ConfigMap or its
                                    key must be defined
                                  type: boolean
                              required:
                              - key
                              type: object
                              x-kubernetes-map-type: atomic
                            fieldRef:
                              description: |-
                                Selects a field of the pod: supports metadata.name, metadata.namespace, `metadata.labels['<KEY>']`, `metadata.annotations['<KEY>']`,
                                spec.nodeName, spec.serviceAccountName, status.hostIP, status.podIP, status.podIPs.
                              properties:
                                apiVersion:
                                  description: Version of the schema the FieldPath
                                    is written in terms of, defaults to "v1".
                                  type: string
                                fieldPath:
                                  description: Path of the field to select in the
                                    specified API version.
                                  type: string
                              required:
                              - fieldPath
                              type: object
                              x-kubernetes-map-type: atomic
                            fileKeyRef:
                              description: |-
                                FileKeyRef selects a key of the env file.
                                Requires the EnvFiles feature gate to be enabled.
                              properties:
                                key:
                                  description: |-
                                    The key within the env file. An invalid key will prevent the pod from starting.
                                    The keys defined within a source may consist of any printable ASCII characters except '='.
                                    During Alpha stage of the EnvFiles feature gate, the key size is limited to 128 characters.
                                  type: string
                                optional:
                                  default: false
                                  description: |-
                                    Specify whether the file or its key must be defined. If the file or key
                                    does not exist, then the env var is not published.
                                    If optional is set to true and the specified key does not exist,
                                    the environment variable will not be set in the Pod's containers.

                                    If optional is set to false and the specified key does not exist,
                                    an error will be returned during Pod creation.
                                  type: boolean
                                path:
                                  description: |-
                                    The path within the volume from which to select the file.
                                    Must be relative and may not contain the '..' path or start with '..'.
                                  type: string
                                volumeName:
                                  description: The name of the volume mount containing
                                    the env file.
                                  type: string
                              required:
                              - key
                              - path
                              - volumeName
                              type: object
                              x-kubernetes-map-type: atomic
                            resourceFieldRef:
                              description: |-
                                Selects a resource of the container: only resources limits and requests
                                (limits.cpu, limits.memory, limits.ephemeral-storage, requests.cpu, requests.memory and requests.ephemeral-storage) are currently supported.
                              properties:
                                containerName:
                                  description: 'Container name: required for volumes,
                                    optional for env vars'
                                  type: string
                                divisor:
                                  anyOf:
                                  - type: integer
                                  - type: string
                                  description: Specifies the output format of the
                                    exposed resources, defaults to "1"
                                  pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                  x-kubernetes-int-or-string: true
                                resource:
                                  description: 'Required: resource to select'
                                  type: string
                              required:
                              - resource
                              type: object
                              x-kubernetes-map-type: atomic
                            secretKeyRef:
                              description: Selects a key of a secret in the pod's
                                namespace
                              properties:
                                key:
                                  description: The key of the secret to select from.  Must
                                    be a valid secret key.
                                  type: string
                                name:
                                  default: ""
                                  description: |-
                                    Name of the referent.
                                    This field is effectively required, but due to backwards compatibility is
                                    allowed to be empty. Instances of this type with an empty value here are
                                    almost certainly wrong.
                                    More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                  type: string
                                optional:
                                  description: Specify whether the Secret or its key
                                    must be defined
                                  type: boolean
                              required:
                              - key
                              type: object
                              x-kubernetes-map-type: atomic
                          type: object
                      required:
                      - name
                      type: object
                    type: array
                  nodeSelector:
                    additionalProperties:
                      type: string
                    description: NodeSelector constrains agent pods to nodes matching
                      the given labels.
                    type: object
                  resources:
                    description: Resources defines resource limits and requests for
                      the agent container.
                    properties:
                      claims:
                        description: |-
                          Claims lists the names of resources, defined in spec.resourceClaims,
                          that are used by this container.

                          This field depends on the
                          DynamicResourceAllocation feature gate.

                          This field is immutable. It can only be set for containers.
                        items:
                          description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                          properties:
                            name:
                              description: |-
                                Name must match the name of one entry in pod.spec.resourceClaims of
                                the Pod where this field is used. It makes that resource available
                                inside a container.
                              type: string
                            request:
                              description: |-
                                Request is the name chosen for a request in the referenced claim.
                                If empty, everything from the claim is made available, otherwise
                                only the result of this request.
                              type: string
                          required:
                          - name
                          type: object
                        type: array
                        x-kubernetes-list-map-keys:
                        - name
                        x-kubernetes-list-type: map
                      limits:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Limits describes the maximum amount of compute resources allowed.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                      requests:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Requests describes the minimum amount of compute resources required.
                          If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                          otherwise to an implementation-defined value. Requests cannot exceed Limits.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                    type: object
                type: object
              prompt:
                description: Prompt is the task prompt to send to the agent.
                type: string
              ttlSecondsAfterFinished:
                description: |-
                  TTLSecondsAfterFinished limits the lifetime of a Task that has finished
                  execution (either Succeeded or Failed). If set, the Task will be
                  automatically deleted after the given number of seconds once it reaches
                  a terminal phase, allowing TaskSpawner to create a new Task.
                  If this field is unset, the Task will not be automatically deleted.
                  If this field is set to zero, the Task will be eligible to be deleted
                  immediately after it finishes.
                format: int32
                minimum: 0
                type: integer
              type:
                description: Type specifies the agent type (e.g., claude-code).
                enum:
                - claude-code
                - codex
                - gemini
                type: string
              workspaceRef:
                description: WorkspaceRef optionally references a Workspace resource
                  for the agent to work in.
                properties:
                  name:
                    description: Name is the name of the Workspace resource.
                    type: string
                required:
                - name
                type: object
            required:
            - credentials
            - prompt
            - type
            type: object
          status:
            description: TaskStatus defines the observed state of Task.
            properties:
              completionTime:
                description: CompletionTime is when the Task completed.
                format: date-time
                type: string
              jobName:
                description: JobName is the name of the Job created for this Task.
                type: string
              message:
                description: Message provides additional information about the current
                  status.
                type: string
              outputs:
                description: |-
                  Outputs contains URLs and references produced by the agent
                  (e.g. branch names, PR URLs).
                items:
                  type: string
                type: array
              phase:
                description: Phase represents the current phase of the Task.
                type: string
              podName:
                description: PodName is the name of the Pod running the Task.
                type: string
              startTime:
                description: StartTime is when the Task started running.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
  name: taskspawners.axon.io
spec:
  group: axon.io
  names:
    kind: TaskSpawner
    listKind: TaskSpawnerList
    plural: taskspawners
    singular: taskspawner
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.taskTemplate.workspaceRef.name
      name: Workspace
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.activeTasks
      name: Active
      type: integer
    - jsonPath: .status.totalDiscovered
      name: Discovered
      type: integer
    - jsonPath: .status.totalTasksCreated
      name: Tasks
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: TaskSpawner is the Schema for the taskspawners API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: TaskSpawnerSpec defines the desired state of TaskSpawner.
            properties:
              maxConcurrency:
                description: |-
                  MaxConcurrency limits the number of concurrently running (non-terminal) Tasks.
                  When the limit is reached, the spawner skips creating new Tasks until
                  existing ones complete. If unset or zero, there is no concurrency limit.
                format: int32
                minimum: 0
                type: integer
              pollInterval:
                default: 5m
                description: PollInterval is how often to poll the source for new
                  items (e.g., "5m"). Defaults to "5m".
                type: string
              taskTemplate:
                description: TaskTemplate defines the template for spawned Tasks.
                properties:
                  agentConfigRef:
                    description: |-
                      AgentConfigRef references an AgentConfig resource.
                      When set, spawned Tasks inherit this agent config reference.
                    properties:
                      name:
                        description: Name is the name of the AgentConfig resource.
                        type: string
                    required:
                    - name
                    type: object
                  credentials:
                    description: Credentials specifies how to authenticate with the
                      agent.
                    properties:
                      secretRef:
                        description: SecretRef references the Secret containing credentials.
                        properties:
                          name:
                            description: Name is the name of the secret.
                            type: string
                        required:
                        - name
                        type: object
                      type:
                        description: Type specifies the credential type (api-key or
                          oauth).
                        enum:
                        - api-key
                        - oauth
                        type: string
                    required:
                    - secretRef
                    - type
                    type: object
                  image:
                    description: |-
                      Image optionally overrides the default agent container image.
                      Custom images must implement the agent image interface
                      (see docs/agent-image-interface.md).
                    type: string
                  model:
                    description: Model optionally overrides the default model.
                    type: string
                  podOverrides:
                    description: PodOverrides allows customizing the agent pod configuration
                      for spawned Tasks.
                    properties:
                      activeDeadlineSeconds:
                        description: |-
                          ActiveDeadlineSeconds specifies the maximum duration in seconds
                          that the agent pod can run before being terminated.
                          This is set on the Job's activeDeadlineSeconds field.
                        format: int64
                        minimum: 1
                        type: integer
                      env:
                        description: |-
                          Env specifies additional environment variables for the agent container.
                          These are appended after the built-in env vars (credentials, model, GitHub token).
                          If a user-specified env var conflicts with a built-in one, the built-in takes precedence.
                        items:
                          description: EnvVar represents an environment variable present
                            in a Container.
                          properties:
                            name:
                              description: |-
                                Name of the environment variable.
                                May consist of any printable ASCII characters except '='.
                              type: string
                            value:
                              description: |-
                                Variable references $(VAR_NAME) are expanded
                                using the previously defined environment variables in the container and
                                any service environment variables. If a variable cannot be resolved,
                                the reference in the input string will be unchanged. Double $$ are reduced
                                to a single $, which allows for escaping the $(VAR_NAME) syntax: i.e.
                                "$$(VAR_NAME)" will produce the string literal "$(VAR_NAME)".
                                Escaped references will never be expanded, regardless of whether the variable
                                exists or not.
                                Defaults to "".
                              type: string
                            valueFrom:
                              description: Source for the environment variable's value.
                                Cannot be used if value is not empty.
                              properties:
                                configMapKeyRef:
                                  description: Selects a key of a ConfigMap.
                                  properties:
                                    key:
                                      description: The key to select.
                                      type: string
                                    name:
                                      default: ""
                                      description: |-
                                        Name of the referent.
                                        This field is effectively required, but due to backwards compatibility is
                                        allowed to be empty. Instances of this type with an empty value here are
                                        almost certainly wrong.
                                        More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                      type: string
                                    optional:
                                      description: Specify whether the ConfigMap or
                                        its key must be defined
                                      type: boolean
                                  required:
                                  - key
                                  type: object
                                  x-kubernetes-map-type: atomic
                                fieldRef:
                                  description: |-
                                    Selects a field of the pod: supports metadata.name, metadata.namespace, `metadata.labels['<KEY>']`, `metadata.annotations['<KEY>']`,
                                    spec.nodeName, spec.serviceAccountName, status.hostIP, status.podIP, status.podIPs.
                                  properties:
                                    apiVersion:
                                      description: Version of the schema the FieldPath
                                        is written in terms of, defaults to "v1".
                                      type: string
                                    fieldPath:
                                      description: Path of the field to select in
                                        the specified API version.
                                      type: string
                                  required:
                                  - fieldPath
                                  type: object
                                  x-kubernetes-map-type: atomic
                                fileKeyRef:
                                  description: |-
                                    FileKeyRef selects a key of the env file.
                                    Requires the EnvFiles feature gate to be enabled.
                                  properties:
                                    key:
                                      description: |-
                                        The key within the env file. An invalid key will prevent the pod from starting.
                                        The keys defined within a source may consist of any printable ASCII characters except '='.
                                        During Alpha stage of the EnvFiles feature gate, the key size is limited to 128 characters.
                                      type: string
                                    optional:
                                      default: false
                                      description: |-
                                        Specify whether the file or its key must be defined. If the file or key
                                        does not exist, then the env var is not published.
                                        If optional is set to true and the specified key does not exist,
                                        the environment variable will not be set in the Pod's containers.

                                        If optional is set to false and the specified key does not exist,
                                        an error will be returned during Pod creation.
                                      type: boolean
                                    path:
                                      description: |-
                                        The path within the volume from which to select the file.
                                        Must be relative and may not contain the '..' path or start with '..'.
                                      type: string
                                    volumeName:
                                      description: The name of the volume mount containing
                                        the env file.
                                      type: string
                                  required:
                                  - key
                                  - path
                                  - volumeName
                                  type: object
                                  x-kubernetes-map-type: atomic
                                resourceFieldRef:
                                  description: |-
                                    Selects a resource of the container: only resources limits and requests
                                    (limits.cpu, limits.memory, limits.ephemeral-storage, requests.cpu, requests.memory and requests.ephemeral-storage) are currently supported.
                                  properties:
                                    containerName:
                                      description: 'Container name: required for volumes,
                                        optional for env vars'
                                      type: string
                                    divisor:
                                      anyOf:
                                      - type: integer
                                      - type: string
                                      description: Specifies the output format of
                                        the exposed resources, defaults to "1"
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    resource:
                                      description: 'Required: resource to select'
                                      type: string
                                  required:
                                  - resource
                                  type: object
                                  x-kubernetes-map-type: atomic
                                secretKeyRef:
                                  description: Selects a key of a secret in the pod's
                                    namespace
                                  properties:
                                    key:
                                      description: The key of the secret to select
                                        from.  Must be a valid secret key.
                                      type: string
                                    name:
                                      default: ""
                                      description: |-
                                        Name of the referent.
                                        This field is effectively required, but due to backwards compatibility is
                                        allowed to be empty. Instances of this type with an empty value here are
                                        almost certainly wrong.
                                        More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                                      type: string
                                    optional:
                                      description: Specify whether the Secret or its
                                        key must be defined
                                      type: boolean
                                  required:
                                  - key
                                  type: object
                                  x-kubernetes-map-type: atomic
                              type: object
                          required:
                          - name
                          type: object
                        type: array
                      nodeSelector:
                        additionalProperties:
                          type: string
                        description: NodeSelector constrains agent pods to nodes matching
                          the given labels.
                        type: object
                      resources:
                        description: Resources defines resource limits and requests
                          for the agent container.
                        properties:
                          claims:
                            description: |-
                              Claims lists the names of resources, defined in spec.resourceClaims,
                              that are used by this container.

                              This field depends on the
                              DynamicResourceAllocation feature gate.

                              This field is immutable. It can only be set for containers.
                            items:
                              description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                              properties:
                                name:
                                  description: |-
                                    Name must match the name of one entry in pod.spec.resourceClaims of
                                    the Pod where this field is used. It makes that resource available
                                    inside a container.
                                  type: string
                                request:
                                  description: |-
                                    Request is the name chosen for a request in the referenced claim.
                                    If empty, everything from the claim is made available, otherwise
                                    only the result of this request.
                                  type: string
                              required:
                              - name
                              type: object
                            type: array
                            x-kubernetes-list-map-keys:
                            - name
                            x-kubernetes-list-type: map
                          limits:
                            additionalProperties:
                              anyOf:
                              - type: integer
                              - type: string
                              pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                              x-kubernetes-int-or-string: true
                            description: |-
                              Limits describes the maximum amount of compute resources allowed.
                              More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                            type: object
                          requests:
                            additionalProperties:
                              anyOf:
                              - type: integer
                              - type: string
                              pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                              x-kubernetes-int-or-string: true
                            description: |-
                              Requests describes the minimum amount of compute resources required.
                              If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                              otherwise to an implementation-defined value. Requests cannot exceed Limits.
                              More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                            type: object
                        type: object
                    type: object
                  promptTemplate:
                    description: |-
                      PromptTemplate is a Go text/template for rendering the task prompt.
                      Available variables: {{.ID}}, {{.Number}}, {{.Title}}, {{.Body}}, {{.URL}}, {{.Comments}}, {{.Labels}}, {{.Kind}}, {{.Time}}, {{.Schedule}}.
                    type: string
                  ttlSecondsAfterFinished:
                    description: |-
                      TTLSecondsAfterFinished limits the lifetime of a Task that has finished
                      execution (either Succeeded or Failed). If set, spawned Tasks will be
                      automatically deleted after the given number of seconds once they reach
                      a terminal phase, allowing TaskSpawner to create a new Task.
                      If this field is unset, spawned Tasks will not be automatically deleted.
                      If this field is set to zero, spawned Tasks will be eligible to be deleted
                      immediately after they finish.
                    format: int32
                    minimum: 0
                    type: integer
                  type:
                    description: Type specifies the agent type (e.g., claude-code).
                    enum:
                    - claude-code
                    - codex
                    - gemini
                    type: string
                  workspaceRef:
                    description: |-
                      WorkspaceRef references the Workspace that defines the repository.
                      Required when using githubIssues source; optional for other sources.
                      When set, spawned Tasks inherit this workspace reference.
                    properties:
                      name:
                        description: Name is the name of the Workspace resource.
                        type: string
                    required:
                    - name
                    type: object
                required:
                - credentials
                - type
                type: object
              when:
                description: When defines the conditions that trigger task spawning.
                properties:
                  cron:
                    description: Cron triggers task spawning on a cron schedule.
                    properties:
                      schedule:
                        description: Schedule is a cron expression (e.g., "0 9 * *
                          1" for every Monday at 9am).
                        type: string
                    required:
                    - schedule
                    type: object
                  githubIssues:
                    description: GitHubIssues discovers issues from a GitHub repository.
                    properties:
                      excludeLabels:
                        description: ExcludeLabels filters out issues that have any
                          of these labels (client-side).
                        items:
                          type: string
                        type: array
                      labels:
                        description: Labels filters issues by labels.
                        items:
                          type: string
                        type: array
                      state:
                        default: open
                        description: State filters issues by state (open, closed,
                          all). Defaults to open.
                        enum:
                        - open
                        - closed
                        - all
                        type: string
                      types:
                        default:
                        - issues
                        description: 'Types specifies which item types to discover:
                          "issues", "pulls", or both.'
                        items:
                          type: string
                        type: array
                    type: object
                type: object
            required:
            - taskTemplate
            - when
            type: object
            x-kubernetes-validations:
            - message: taskTemplate.workspaceRef is required when using githubIssues
                source
              rule: '!has(self.when.githubIssues) || has(self.taskTemplate.workspaceRef)'
          status:
            description: TaskSpawnerStatus defines the observed state of TaskSpawner.
            properties:
              activeTasks:
                description: ActiveTasks is the number of currently active (non-terminal)
                  Tasks.
                type: integer
              deploymentName:
                description: DeploymentName is the name of the Deployment running
                  the spawner.
                type: string
              lastDiscoveryTime:
                description: LastDiscoveryTime is the last time the source was polled.
                format: date-time
                type: string
              message:
                description: Message provides additional information about the current
                  status.
                type: string
              phase:
                description: Phase represents the current phase of the TaskSpawner.
                type: string
              totalDiscovered:
                description: TotalDiscovered is the total number of work items discovered.
                type: integer
              totalTasksCreated:
                description: TotalTasksCreated is the total number of Tasks created.
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
  name: workspaces.axon.io
spec:
  group: axon.io
  names:
    kind: Workspace
    listKind: WorkspaceList
    plural: workspaces
    singular: workspace
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Workspace is the Schema for the workspaces API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: WorkspaceSpec defines the desired state of Workspace.
            properties:
              files:
                description: |-
                  Files are written into the cloned repository before the agent starts.
                  This can be used to inject plugin-like assets such as skills
                  (for example, ".claude/skills/<name>/SKILL.md") and instruction files
                  like "CLAUDE.md" or "AGENTS.md".
                items:
                  description: |-
                    WorkspaceFile defines a file to write into the cloned repository before the
                    agent container starts.
                  properties:
                    content:
                      description: Content is the file content to write.
                      type: string
                    path:
                      description: |-
                        Path is the relative file path inside the repository (for example,
                        ".claude/skills/reviewer/SKILL.md" or "CLAUDE.md").
                      minLength: 1
                      type: string
                  required:
                  - content
                  - path
                  type: object
                type: array
              ref:
                description: |-
                  Ref is the git reference to checkout (branch, tag, or commit SHA).
                  Defaults to the repository's default branch if not specified.
                type: string
              repo:
                description: Repo is the git repository URL to clone.
                pattern: ^(https?://|git://|git@).*
                type: string
              secretRef:
                description: |-
                  SecretRef references a Secret containing a GITHUB_TOKEN key for git
                  authentication and GitHub CLI (gh) operations.
                properties:
                  name:
                    description: Name is the name of the secret.
                    type: string
                required:
                - name
                type: object
            required:
            - repo
            type: object
        type: object
    served: true
    storage: true
